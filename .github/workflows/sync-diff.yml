name: Sync Diff Files
on:
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:
jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source Repository
        uses: actions/checkout@master
        with:
          repository: emacsmirror/emacswiki.org
          ref: master
      - name: Checkout Repository to Copy Settings
        uses: actions/checkout@master
        with:
          path: dst
      - name: Copy Settings
        run: |
          mkdir -p .github
          cp dst/.github/sync.yml .github/
      - name: Checkout Repository
        uses: actions/checkout@master
        with:
          path: dst
          ref: master
      - name: Generate Diffs
        uses: mikefarah/yq@master
        with:
          cmd: |
            cat .github/sync.yml > test.yml
            yq '.' test.yml
            yq . .github/sync.yml
      - name: Run GitHub File Diff Sync
        uses: BetaHuhn/repo-file-sync-action@latest
        with:
          GH_PAT: ${{ secrets.GH_PAT }}
          DRY_RUN: true
